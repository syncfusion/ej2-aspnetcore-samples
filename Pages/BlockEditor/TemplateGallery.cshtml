@page
@model EJ2CoreSampleBrowser_NET9.Pages.BlockEditor.TemplateGalleryModel
@using Syncfusion.EJ2
@using System.Text.Json

@section ControlsSection {
    <div id="control-section" class="control-section blockeditor-template">
        <div class="cards-wrapper" style="position: relative;">
            <div class="fade left"></div>
            <div id="cardsContainer" class="cards-container"></div>
            <div class="fade right"></div>
        </div>
        <div class="header-label" contenteditable="true">
            <span id="selectedTitle" class="selectedTitle" aria-placeholder="Untitle"></span>
        </div>

        <ejs-blockeditor id="markdown-blockeditor" height="500px" created="onEditorCreated" blocks="@Model.InitialBlocks">
        </ejs-blockeditor>

    </div>
}

@section PreScripts {
<script>
    // Server JSON with enums as strings
    const TEMPLATE_PAGES = @Html.Raw(Model.TemplatePagesJson);

    function getEditor() {
        // Prefer getComponent for consistency across Core samples
        return ej.base.getComponent(document.getElementById('markdown-blockeditor'), 'blockeditor');
    }

    function onEditorCreated() {
        buildCards();
        if (TEMPLATE_PAGES && TEMPLATE_PAGES.length) {
            const first = TEMPLATE_PAGES[1];
            setHeader(first.Icon, first.Name);
            activateCard(first.Id);
            const editor = getEditor();
            editor.focusIn();
        }
    }

    function buildCards() {
        const container = document.getElementById('cardsContainer');
        if (!container || !TEMPLATE_PAGES) return;
        container.innerHTML = '';
        TEMPLATE_PAGES.forEach(page => {
            const card = document.createElement('div');
            card.className = 'template-card';
            card.tabIndex = 0;
            card.title=page.Id;
            card.dataset.id = page.Id;
            card.innerHTML = `
<div class="card-icon-left"><span class="icon">${page.Icon || ''}</span></div>
<div class="card-content">
  <div class="card-title">${page.Name || ''}</div>
  <div class="card-subtitle">${page.Subtitle || ''}</div>
</div>`;
            card.addEventListener('click', () => selectPage(page));
            card.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); selectPage(page); }
            });
            container.appendChild(card);
        });
    }

    function selectPage(page) {
        const editor = getEditor();
        if (!editor) return;
        const blocks = page.Blocks || [];
        // Replace all content with selected template
        editor.renderBlocksFromJson(blocks, true);
        setHeader(page.Icon, page.Name);
        activateCard(page.Id);
        editor.focusIn();
    }

    function setHeader(icon, name) {
        const title = document.getElementById('selectedTitle');
        if (title) title.textContent = `${icon || ''} ${name || ''}`.trim();
    }

    function activateCard(id) {
        const container = document.getElementById('cardsContainer');
        if (!container) return;
        Array.from(container.children).forEach(el => el.classList.remove('active'));
        const active = Array.from(container.children).find(el => el.dataset.id === id);
        if (active) active.classList.add('active');
    }

</script>
}

<style>
.blockeditor-template {
    margin: 10px;
    border: 1px solid #dee2e6;
}
.header-label { padding: 15px 20px; }
.selectedTitle {
    font-family: var(--fontFamilyBase, var(--ms-themeFontFamilyBody));
    font-size: 2.25em;
    font-weight: 600;
    color: var(--ms-themeColorBodyText, var(--colorNeutralForeground1, #323130));
    line-height: 48px;
}
.cards-container {
    display: flex; gap: 8px; padding: 10px 20px; transition: .3s; overflow: hidden;
    flex-wrap: nowrap;
}
.fade { position: absolute; top: 0; width: 60px; height: 100%; pointer-events: none; opacity: 0; transition: opacity .3s; z-index: 10; }
.fade.left { left: 0; background: linear-gradient(to right, #f8f9fa 30%, transparent 100%); }
.fade.right { right: 0; background: linear-gradient(to left, #f8f9fa 30%, transparent 100%); }
.template-card { max-width: 180px; min-width: 60px; height: 60px; background: white; border-radius: 18px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); border: 1px solid #eee; display: flex; align-items: center; padding: 8px; cursor: pointer; transition: all 0.25s ease; user-select: none; text-overflow: ellipsis; overflow: hidden; white-space: nowrap;
}

.template-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.12); }
.template-card.active { border: 1px solid #007bff; box-shadow: 0 0 0 1px rgba(0,123,255,0.2); }
.card-icon-left { margin-right: 10px; }
.icon { font-size: 28px; }
.card-title { font-size: 14px; font-weight: 500; color: #1a1a1a; margin-bottom: 4px; }
.card-subtitle { font-size: 10px; color: #666; }
@@media (max-width: 650px) {
    .blockeditor-template .cards-container {
        align-items: center;
        justify-content: center;
    }

    .template-card {
        justify-content: center;
    }

    .template-card .card-content {
        display: none;
    }

    .blockeditor-template .card-icon-left {
        margin-right: 0;
    }
    }
    /* Default styles (for >900px): show full text, no truncation needed */
    .template-card .card-content {
        flex: 1;
        min-width: 0;
        overflow: hidden;
    }

    .template-card .card-title,
    .template-card .card-subtitle {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        display: block;
    }

    body[class*="dark"] .template-card,
    body[class*="high"] .template-card {
        background-color: var(--color-sf-content-bg-color);
    }

    body[class*="dark"] .blockeditor-template .card-subtitle, body[class*="dark"] .blockeditor-template .card-title, body[class*="dark"] .blockeditor-template .selectedTitle,
    body[class*="high"] .blockeditor-template .card-subtitle, body[class*="high"] .blockeditor-template .card-title, body[class*="high"] .blockeditor-template .selectedTitle {
        color: #fff;
    }

    body[class*="high"] .blockeditor-template {
        background: var(--color-sf-content-bg-color);
    }

    /* Between 650px and 900px: Show text but truncate with ellipsis when it overflows */
    @@media (min-width: 650px) and (max-width: 1050px) {
    .template-card {
        min-width: 100px;
        max-width: 200px;
    }

    .template-card .card-content {
        display: block;
    }
    }
</style>

@section Meta {
    <meta name="description" content="This example demonstrates the Use Cases in ASP.NET Core Block Editor control. Explore here for more details." />
}

@section ActionDescription {
    <div id="action-description">
        <p>
            This sample demonstrates a Template Gallery for the Block Editor; use the horizontal card rail to choose a
            template, load its blocks into the editor, and customize the content with slash (<code>/</code>) commands,
            lists, and inline formatting.
        </p>
    </div>
}
@section Description {
    <div id="description">
        <p>
            This sample implements a Template Gallery for the Block Editor. A horizontal set of cards acts as a template
            picker; selecting a card loads its predefined block structure into the editor without reloading the page.
        </p>
        <ul>
            <li><b>Interactive cards:</b> Click a card to select a template with active styling for the selected item.</li>
            <li>
                <b>Dynamic loading:</b> Clicking a card calls
                <a target="_blank" href="https://ej2.syncfusion.com/angular/documentation/api/blockeditor/index-default#renderblocksfromjson">
                    {' '}renderBlocksFromJson
                </a> to populate the editor with that template's blocks.
            </li>
            <li><b>Responsive behavior:</b> The card rail scrolls when content overflows.</li>
            <li><b>Templates included:</b> Blank Page, Project Brief, Team Decisions, Project Planning, and Meeting Notes.</li>
        </ul>
        <p>
            Use this gallery to kickstart common document plan projects, record decisions, run meetings, and more then
            tailor the content with headings, lists, checklists, and rich inline styles.
        </p>
    </div>
}