@page 
@using Syncfusion.EJ2
@using Syncfusion.EJ2.Inputs
@using Syncfusion.EJ2.DropDowns
@using Syncfusion.EJ2.SmartComponents

@{
    var roles = new List<object>
    {
        new { ID = "Role1", Text = "Maintainer of an open-source project replying to GitHub issues" },
        new { ID = "Role2", Text = "Employee communicating with internal team" },
        new { ID = "Role3", Text = "Customer support representative responding to customer queries" },
        new { ID = "Role4", Text = "Sales representative responding to client inquiries" }
    };
    var presets = new[]
    {
        new { userRole = "Maintainer of an open-source project replying to GitHub issues", userPhrases = new[] { "Thank you for contacting us.", "To investigate, we'll need a repro as a public Git repo.", "Could you please post a screenshot of NEED_INFO?", "This sounds like a usage question. This issue tracker is intended for bugs and feature proposals. Unfortunately, we don't have the capacity to answer general usage questions and would recommend StackOverflow for a faster response.", "We don't accept ZIP files as repros." }, placeHolder = "Write your response to the GitHub issue..." },
        new { userRole = "Customer support representative responding to customer queries", userPhrases = new[] { "Thank you for reaching out to us.", "Can you please provide your order number?", "We apologize for the inconvenience.", "Our team is looking into this issue and will get back to you shortly.", "For urgent matters, please call our support line." }, placeHolder = "Enter your reply to the customer query..." },
        new { userRole = "Employee communicating with internal team", userPhrases = new[] { "Please find the attached report.", "Let's schedule a meeting to discuss this further.", "Can you provide an update on this task?", "I appreciate your prompt response.", "Let's collaborate on this project to ensure timely delivery." }, placeHolder = "Draft your message for the team..." },
        new { userRole = "Sales representative responding to client inquiries", userPhrases = new[] { "Thank you for your interest in our product.", "Can I schedule a demo for you?", "Please find the pricing details attached.", "Our team is excited to work with you.", "Let me know if you have any further questions." }, placeHolder = "Enter your reply to the client's inquiry..." }
    };
    var currentPreset = presets[0];
    var selectedRole = "Role1";
}

@section ControlsSection{
    <div class="control-section">
        <div class="content-wrapper">
            <div class="example-label">Select a role</div>
            <ejs-dropdownlist id="roleDropdown" width="75%" dataSource="@roles" placeholder="Select a role" value="@selectedRole" change="onRoleChange">
                <e-dropdownlist-fields text="Text" value="ID"></e-dropdownlist-fields>
            </ejs-dropdownlist>
            <ejs-smarttextarea id="smartTextarea" user-role="@currentPreset.userRole" user-phrases="@currentPreset.userPhrases" width="75%" placeholder="@currentPreset.placeHolder" floatLabelType="Auto" rows="5" input="handleSmartText"></ejs-smarttextarea>
        </div>
    </div>
}

<style>
    .content-wrapper {
        margin: 50px auto;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
    }
    .example-label {
        width: 75%;
        font-weight: 700;
    }
</style>

<script>
    async function setTextareaConfig(textareaElement, preset, userID) {
        try {
            const smartTextarea = textareaElement?.ej2_instances?.[0];
            const customElement = document.querySelector('smart-textarea');

            if (!smartTextarea || !customElement || !preset) {
                throw new Error('Required elements or preset not found');
            }

            const config = {
                UserRole: `${preset.userRole} fingerprintID: ${userID}`,
                UserPhrases: preset.userPhrases
            };

            customElement.setAttribute('data-config', JSON.stringify(config));
            smartTextarea.placeholder = preset.placeHolder;
            smartTextarea.dataBind();
        } catch (error) {
            console.error('Error setting textarea config:', error);
        }
    }

    async function onRoleChange(args) {
        try {
            const dropdown = document.getElementById('roleDropdown')?.ej2_instances?.[0];
            if (!dropdown) {
                throw new Error('Dropdown element not found');
            }

            const presets = @Html.Raw(Json.Serialize(presets));
            const preset = presets.find(p => p.userRole === dropdown.text);
            if (!preset) {
                throw new Error('Preset not found for selected role');
            }

            const userID = await fingerPrint();
            await setTextareaConfig(document.getElementById('smartTextarea'), preset, userID);
        } catch (error) {
            console.error('Error in onRoleChange:', error);
        }
    }

    async function handleSmartText() {
        try {
            const userID = await fingerPrint();
            const tokens = await getRemainingTokens(userID);

            if (tokens.remainingTokens <= 300) {
                showBanner(tokens.alertMessage);
            }
        } catch (error) {
            console.error('Error in handleSmartText:', error);
        }
    }

    window.onload = async function() {
        try {
            const textareaElement = document.getElementById('smartTextarea');
            const preset = @Html.Raw(Json.Serialize(currentPreset));
            const userID = await fingerPrint();

            await setTextareaConfig(textareaElement, preset, userID);
        } catch (error) {
            console.error('Error in window.onload:', error);
        }
    };
</script>

@section Meta{
<meta name="description" content="This example demonstrates the autocompletion suggestions in ASP.NET Core Smart TextArea. Explore here for more details." />
}
@section ActionDescription{
<div id="action-description">
    <p>
        This example demonstrates how the Smart TextArea provides sentence-level autocompletion suggestions based on its configuration and the user's current input.
    </p>
</div>
}
@section Description{
<div id="description">
    <p>The Smart TextArea uses AI to offer real-time sentence suggestions based on the user's input and role, helping users complete sentences more quickly and accurately.</p>
</div>
}
@section Title{
<title>ASP.NET Core Smart TextArea Example - Syncfusion Demos </title>
}
@section Header{
<h1 class='sb-sample-text'>Example of Autocompletion Suggestions in ASP.NET Core Smart TextArea</h1>
}