@page

@using EJ2CoreSampleBrowser.Models
@using Syncfusion.EJ2.PivotView
@section Meta{
    <meta name="description" content="This example demonstrates the External Date Range Filtering in ASP.NET Core Pivot Table control. Explore here for more details."/>
}

@{
	var startDate = new DateTime(2024, 01, 01);
	var endDate = new DateTime(2024, 12, 01);
	var format = "MMM yyyy";
	var start = "Year";
	var depth = "Year";
	var startMax = new DateTime(2024, 10, 31);
	var startMin = new DateTime(2019, 1, 1);
	var endMax = new DateTime(2024, 12, 31);
	var endMin = new DateTime(2019, 1, 1);
	var drilledMembers = new string[] { "Canada" };
	var groupMembers = new string[] { "Years", "Months" };
}
@section ControlsSection {

	<div class="control-section">
		<div class="content-wrapper">
			<div style="padding: 0px 10px; display: flex; align-items: center;">
				<strong style="display: inline-block; font-size: 14px; margin-right: 5px;">Start Date:</strong>
				<ejs-datepicker id="start-datepicker" cssClass="pivot-datepicker" placeholder="Choose a start date" value="@startDate" min="@startMin" max="@startMax"
								width="200" format="@format" start="Year" depth="Year" change="startDateChange"></ejs-datepicker>
				<strong style="display: inline-block; font-size: 14px; margin-right: 5px;">End Date:</strong>
				<ejs-datepicker id="end-datepicker" cssClass="pivot-datepicker" placeholder="Choose an end date" value="@endDate" min="@endMin" max="@endMax"
								width="200" format="@format" start="Year" depth="Year" change="endDateChange"></ejs-datepicker>
				<div style="margin-left: 10px;">
					<ejs-button id="apply" content="Apply" isPrimary="true"></ejs-button>
				</div>
			</div>
			<ejs-pivotview id="PivotView" width="100%" height="500" load="onLoad">
				<e-datasourcesettings expandAll="true" enableSorting="true">
					<e-formatsettings>
						<e-field name="Amount" format="C0"></e-field>
						<e-field name="OrderDate" format="dd/MM/yyyy" type="date"></e-field>
					</e-formatsettings>
					<e-rows>
						<e-field name="OrderDate"></e-field>
					</e-rows>
					<e-columns>
						<e-field name="Country"></e-field>
						<e-field name="Product"></e-field>
					</e-columns>
					<e-values>
						<e-field name="Amount" caption="Total Sales"></e-field>
					</e-values>
					<e-drilledmembers>
						<e-field name="Country" items="@drilledMembers"></e-field>
					</e-drilledmembers>
					<e-groupsettings>
						<e-field name="OrderDate" groupInterval="@groupMembers"></e-field>
					</e-groupsettings>
				</e-datasourcesettings>
				<e-gridSettings columnWidth="140"></e-gridSettings>
			</ejs-pivotview>
		</div>
	</div>

	<style>
		@@media only screen and (max-width: 400px) {
			#pivot-table-section {
				overflow: auto;
			}
		}

		.e-date-wrapper {
			margin: 10px 20px 10px 0px !important;
		}

		.tailwind3 .pivot-datepicker .e-calendar .e-btn.e-today.e-flat.e-primary.e-disabled,
		.tailwind3-dark .pivot-datepicker .e-calendar .e-btn.e-today.e-flat.e-primary.e-disabled {
			background: #a5b4fc !important;
			border-color: #a5b4fc !important;
		}
	</style>
	<script src="~/scripts/pivotData/data-source.js"></script>
	<script type="text/javascript">
		var startingDate = new Date('2024-01-01');
		var endingDate = new Date('2024-12-01');
		var Pivot_Data = window.dateFilterData;
		function onLoad(args) {
			applyDateFilter();
		}
		function endDateChange(args) {
			endingDate = args.value;
		}
		function startDateChange(args) {
			startingDate = args.value;
		}
		function applyDateFilter(args) {
			var pivotObj = document.getElementById('PivotView').ej2_instances[0];
			if (startingDate && endingDate) {
				startingDate.setHours(0, 0, 0, 0);
				endingDate.setHours(23, 59, 59, 999);
				var pivotData = Pivot_Data.map(function (item) {
					var newItem = Object.assign({}, item);
					newItem.OrderDate = new Date(item.OrderDate);
					return newItem;
				});
				new ej.data.DataManager({ json: pivotData, adaptor: new ej.data.JsonAdaptor() }).executeQuery(
					new ej.data.Query()
						.where('OrderDate', 'greaterthanorequal', startingDate)
						.where('OrderDate', 'lessthanorequal', endingDate)
				)
					.then(function (e) {
						pivotObj.dataSourceSettings.dataSource = e.result;
					});
			}
		}
		document.getElementById('apply').onclick = function () {
			applyDateFilter();
		}
	</script>
}

@section PreScripts {
    <script>
        ej.base.enableRipple(false);
    </script>
}

@section ActionDescription{
	<div id="action-description">
		<p>This sample demonstrates how to apply an external date range filter to the Pivot Table data source, enhancing
        performance and responsiveness when working with large datasets.</p>
	</div>
}

@section Description{
	<div id="description">
		<p>In this sample, date filtering is performed externally by updating the Pivot Table's data source based on a
            selected date range. Users can choose a <b>Start Date</b> and <b>End Date</b> using date pickers, and the table
            updates to show only the records that fall within that range.</p>
        <p>This external filtering method improves performance by avoiding in-component filtering. Instead, the data is
            pre-filtered at runtime using a custom <code>applyDateFilter</code> function, which compares the selected date
            range with each record's date in the original dataset. This reduces the processing load on the Pivot Table and
            results in a more responsive user experience.</p>
        <p><b> Note:</b> Aggregation in the Pivot Table is performed only on the filtered data. Any records outside the
            selected date range are excluded from the summary calculations.</p>
        <p>
            More information on the ASP.NET Core Pivot Table can be found in this <a target="_blank"
                href="https://ej2.syncfusion.com/aspnetcore/documentation/pivot-table/getting-started#adding-pivot-table-component">
                documentation section
            </a>.
        </p>
	</div>
}
@section Title{
                    <title>ASP.NET Core Pivot Table External Date Range Filtering Example - Syncfusion Demos </title> 
                }
@section Header{
                    <h1 class='sb-sample-text'>Example of External Date Range Filtering in ASP.NET Core Pivot Table Control</h1>
                }